from flask import Flask, render_template, request, flash, redirect
from werkzeug.utils import secure_filename

import pickle
import sklearn
import secrets
import os
import requests
import csv
import pandas as pd

app = Flask(__name__)
secret = secrets.token_urlsafe(32)
app.secret_key = secret

model = pickle.load(open('C:\\Users\\Home\\Desktop\\untitled1\\static\\Malware.pkl', 'rb'))
a = model.predict([[215648, 16, 48478, 1163, 443, 6, 54295, 1, 2, 0.0, 31.0, 0.0, 0.0, 0.000000, 0.0000, 31.0, 0.0,
                    15.5, 21.92031, 570.954968, 55.253707, 27147.5, 38123.662108, 54105.0, 190.0, 0.0, 0.0, 0.000000,
                    0.0, 0.0, 190.0, 190.0, 0.000000, 190.0, 190.0, 0, 32, 64, 18.417902, 36.835804, 0.0, 31.0, 7.75,
                    15.500000, 240.250000, 0, 0, 0, 1, 1, 2.0, 10.333333, 0.000000, 15.5, 32, 1, 0, 2, 31, 1550, 122, 0,
                    32, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4, 160]])


@app.route("/")
def home():
    return render_template("mdata.html")


@app.route("/")
def result():
    return 'All fields are required.'


@app.route('/dash', methods=["GET", "POST"])
def dash():
    data = pd.read_csv("static\\test1.csv")
    z = list(data)
    print(z)
    a = model.predict([z])
    return render_template("data.html", data=a)


@app.route('/data', methods=["GET", "POST"])
def data():
    if request.method == 'POST':
        file = request.files["csvfile"]
        if not os.path.isdir('testfiles'):
            os.mkdir('testfiles')
        filepath = os.path.join('testfiles', file.filename)
        file.save(filepath)
        content = pd.read_csv(filepath)
        z = list(content)
        detection = model.predict([z])
        b = 1  # to default make is as no virus detected
        if detection[0] == 0:
            printstr = "Virus Detected: Ransomware"
        elif detection[0] == 1:
            printstr = "Virus Detected: Adware"
        elif detection[0] == 2:
            printstr = "Virus Detected: Scareware"
        elif detection[0] == 3:
            printstr = "Virus Detected: SmSmalware"
        else:
            printstr = "No Virus Detected"
            b = 0
        return render_template("data.html", data=printstr, b=b)


@app.route('/team')
def team():
    return render_template("team.html")


@app.route('/hello')
def hello():
    r = requests.get('http://www.google.com')
    return r.text


if __name__ == "__main__":
    app.run(debug=True)
